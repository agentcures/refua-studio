<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Refua Studio</title>
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body>
    <div class="ambient ambient-a" aria-hidden="true"></div>
    <div class="ambient ambient-b" aria-hidden="true"></div>

    <header class="app-header reveal" style="--delay: 0.04s">
      <div class="brand-block">
        <p class="kicker">Refua Platform</p>
        <h1>Refua Studio</h1>
        <p class="subtitle">
          Enterprise control plane for ClawCures campaign planning, execution, validation, and portfolio review.
        </p>
      </div>
      <div class="header-actions">
        <div class="status-chip" id="connectionChip" title="API connectivity">
          <span class="dot"></span>
          <span class="status-text">Checking...</span>
        </div>
        <button id="refreshEcosystemButton" class="btn btn-outline btn-small">Refresh Ecosystem</button>
      </div>
    </header>

    <main class="dashboard">
      <section class="panel panel-full reveal" style="--delay: 0.08s">
        <div class="panel-head">
          <h2>Platform & ClawCures Alignment</h2>
          <div class="inline-controls">
            <label class="toggle compact-toggle">
              <input type="checkbox" id="handoffWriteFileToggle" checked />
              <span>Write Handoff Artifact</span>
            </label>
            <button id="generateHandoffButton" class="btn btn-accent btn-small">Generate Handoff</button>
          </div>
        </div>

        <div id="ecosystemWarnings" class="notice" hidden></div>

        <div id="productGrid" class="product-grid"></div>

        <div class="platform-columns">
          <article class="subpanel">
            <h3>ClawCures Default Objective</h3>
            <p id="defaultObjectiveText" class="subpanel-text">Loading...</p>
            <button id="loadClawCuresObjectiveButton" class="btn btn-outline btn-small">Use Objective</button>
          </article>

          <article class="subpanel">
            <h3>Default System Prompt Preview</h3>
            <pre id="defaultPromptPreview" class="compact-pre">Loading...</pre>
          </article>

          <article class="subpanel">
            <h3>ClawCures Commands</h3>
            <label for="handoffArtifactNameInput">Artifact Name (optional)</label>
            <input
              type="text"
              id="handoffArtifactNameInput"
              placeholder="clawcures_kras_handoff.json"
              spellcheck="false"
            />
            <pre id="clawcuresCommandOutput" class="compact-pre">Generate a handoff to populate commands.</pre>
          </article>
        </div>
      </section>

      <section class="panel reveal" style="--delay: 0.12s">
        <h2>Mission Run</h2>

        <label for="objectiveTemplateSelect">Objective Template</label>
        <div class="row actions-row">
          <select id="objectiveTemplateSelect"></select>
          <button id="loadObjectiveTemplateButton" class="btn btn-outline btn-small">Load</button>
        </div>

        <label for="objectiveInput">Objective</label>
        <textarea id="objectiveInput" rows="4" spellcheck="false"></textarea>

        <label for="systemPromptInput">System Prompt Override (optional)</label>
        <textarea id="systemPromptInput" rows="4" spellcheck="false"></textarea>

        <div class="row">
          <label class="toggle">
            <input type="checkbox" id="dryRunToggle" />
            <span>Dry Run</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="asyncToggle" checked />
            <span>Async Job</span>
          </label>
        </div>

        <div class="row three">
          <label>
            Max Rounds
            <input type="number" id="maxRoundsInput" min="1" value="3" />
          </label>
          <label>
            Max Calls
            <input type="number" id="maxCallsInput" min="1" value="10" />
          </label>
          <label class="toggle compact">
            <input type="checkbox" id="skipValidateFirstToggle" />
            <span>Skip Validate-First</span>
          </label>
        </div>

        <div class="button-row">
          <button id="planButton" class="btn btn-outline">Plan</button>
          <button id="runButton" class="btn btn-primary">Run</button>
          <button id="autonomousButton" class="btn btn-accent">Run Autonomous</button>
        </div>
      </section>

      <section class="panel reveal" style="--delay: 0.16s">
        <h2>Plan Editor</h2>

        <label for="planTemplateSelect">Plan Template</label>
        <div class="row actions-row">
          <select id="planTemplateSelect"></select>
          <button id="loadPlanTemplateButton" class="btn btn-outline btn-small">Load</button>
          <button id="formatPlanButton" class="btn btn-outline btn-small">Format</button>
        </div>

        <label for="planInput">Tool Plan (JSON)</label>
        <textarea id="planInput" rows="13" spellcheck="false"></textarea>

        <div class="button-row">
          <button id="validatePlanButton" class="btn btn-outline">Validate</button>
          <button id="executePlanButton" class="btn btn-primary">Execute Plan</button>
        </div>
      </section>

      <section class="panel reveal" style="--delay: 0.20s">
        <h2>Portfolio Ranker</h2>

        <label for="portfolioTemplateSelect">Portfolio Template</label>
        <div class="row actions-row">
          <select id="portfolioTemplateSelect"></select>
          <button id="loadPortfolioTemplateButton" class="btn btn-outline btn-small">Load</button>
          <button id="formatPortfolioButton" class="btn btn-outline btn-small">Format</button>
        </div>

        <label for="portfolioInput">Disease Programs (JSON array)</label>
        <textarea id="portfolioInput" rows="10" spellcheck="false"></textarea>

        <div class="button-row">
          <button id="rankPortfolioButton" class="btn btn-accent">Rank Portfolio</button>
        </div>
      </section>

      <section class="panel panel-wide reveal" style="--delay: 0.24s">
        <div class="panel-head">
          <h2>Job History</h2>
          <div class="inline-controls">
            <select id="jobStatusFilter">
              <option value="">All</option>
              <option value="queued">Queued</option>
              <option value="running">Running</option>
              <option value="completed">Completed</option>
              <option value="failed">Failed</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <button id="refreshJobsButton" class="btn btn-outline btn-small">Refresh</button>
            <button id="cancelJobButton" class="btn btn-outline btn-small">Cancel</button>
            <button id="clearFinishedJobsButton" class="btn btn-outline btn-small">Clear Finished</button>
          </div>
        </div>

        <div id="jobsCountSummary" class="panel-meta"></div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Job ID</th>
                <th>Kind</th>
                <th>Status</th>
                <th>Updated</th>
                <th>Duration</th>
              </tr>
            </thead>
            <tbody id="jobsBody"></tbody>
          </table>
        </div>
      </section>

      <section class="panel reveal" style="--delay: 0.28s">
        <div class="panel-head">
          <h2>Tooling & Runtime</h2>
          <button id="refreshToolsButton" class="btn btn-outline btn-small">Refresh</button>
        </div>
        <pre id="toolsOutput"></pre>
      </section>

      <section class="panel panel-full panel-cures reveal" style="--delay: 0.32s">
        <div class="panel-head">
          <div>
            <p class="cures-kicker">Unicorn Tier Discovery</p>
            <h2>Promising Cures</h2>
          </div>
          <div class="inline-controls">
            <label class="inline-label" for="drugMinScoreInput">Min Score</label>
            <input type="number" id="drugMinScoreInput" min="0" max="100" value="50" step="1" />
            <button id="refreshDrugPortfolioButton" class="btn btn-outline btn-small">Refresh</button>
          </div>
        </div>
        <div id="drugPortfolioSummary" class="drug-summary-grid"></div>
        <div class="cures-layout">
          <div id="drugPortfolioCards" class="drug-cards"></div>
          <article class="cure-detail-card">
            <div id="cureDetailHeader" class="cure-detail-header">Select a candidate cure</div>
            <p id="cureAssessment" class="cure-assessment">
              Pick a therapeutic card to inspect full ADMET properties and assessment.
            </p>
            <div id="cureMetricPills" class="metric-row"></div>

            <h3>Key ADMET Metrics</h3>
            <div id="admetKeyMetrics" class="admet-key-grid"></div>

            <h3>Full ADMET Properties</h3>
            <div id="admetPropertiesGrid" class="admet-property-grid"></div>

            <details class="raw-json-toggle">
              <summary>Raw Candidate JSON</summary>
              <pre id="drugPortfolioDetail"></pre>
            </details>
          </article>
        </div>
      </section>

      <section class="panel panel-full reveal" style="--delay: 0.36s">
        <div class="panel-head">
          <h2>Output</h2>
          <button id="clearOutputButton" class="btn btn-outline btn-small">Clear</button>
        </div>
        <pre id="resultOutput"></pre>
      </section>
    </main>

    <script src="/assets/app.js" defer></script>
  </body>
</html>
